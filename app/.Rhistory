df1 <- finaldata %>% group_by(DBA)%>%summarise(n=n())
View(df1)
View(df1)
finaldata %>%
filter(DBA="-196 CELSIUS")%>%nrow()
finaldata %>%
filter(DBA=="-196 CELSIUS")%>%nrow()
df1 <- df1%>%filter(!is.na(DBA))
View(df1)
df1 <- df1%>%filter(!is.null(DBA))
View(df1)
df1 <- df1%>%filter(!is.null(DBA)) & !is.na(DBA)
df1 <- df1%>%filter(!is.null(DBA)) & !is.na(DBA))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
View(df)
View(finaldata)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%summarise(n=n())
View(df1)
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
View(df1)
View(df1)
?box
?sliderInput
ls("package:shiny", pattern="Iutput$")
ls("package:shiny", pattern="Input$")
ls("package:shiny", pattern="Output$")
?formulaText
View(df1)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%mutate(n=n())
View(df1)
names(df1)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select(c(DBA,BORO,CUISINE.DESCRIPTION,VIOLATION.CODE,SCORE,GRADE,lat,long,INSPECTION.YEAR,n)))
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,VIOLATION.CODE,SCORE,GRADE,lat,long,INSPECTION.YEAR,n))
SCOREGRADE,lat
View(df1)
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
View(df1)
View(df1)
View(finaldata)
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="3")]<- "03-Food Source"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="4")]<- "04-Food Protection"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="5")]<- "05-Working Environment Safety"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="6")]<- "06-Workers Cleanliness"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="7")]<- "07-Duties of Officer"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="8")]<- "08-Facility Issues"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="9")]<- "09-Food Storage"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="10")]<- "10-Utility Issues"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="15")]<- "15-Tabacco Issues"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="16")]<- "16-Food Nuitrition/Calories"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="18")]<- "18-Documents Not Present"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="20")]<- "20-Information Not Posted"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="22")]<- "22-Facility Issues 2"
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="99")]<- "99-Other General Violation"
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
df1$VIOLATION.DESCRIPTION <- NA
View(df1)
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,
VIOLATION.CODE,SCORE,GRADE,lat,long,
INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="3")]<- "03-Food Source"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="4")]<- "04-Food Protection"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="5")]<- "05-Working Environment Safety"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="6")]<- "06-Workers Cleanliness"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="7")]<- "07-Duties of Officer"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="8")]<- "08-Facility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="9")]<- "09-Food Storage"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="10")]<- "10-Utility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="15")]<- "15-Tabacco Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="16")]<- "16-Food Nuitrition/Calories"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="18")]<- "18-Documents Not Present"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="20")]<- "20-Information Not Posted"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="22")]<- "22-Facility Issues 2"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="99")]<- "99-Other General Violation"
View(df1)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,lat,long,INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="3")]<- "03-Food Source"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="4")]<- "04-Food Protection"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="5")]<- "05-Working Environment Safety"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="6")]<- "06-Workers Cleanliness"
#RESTAURANT SUMMARY data processing#
names(finaldata)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,lat,long,INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
View(df1)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,VIOLATION.CODE, lat,long,INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="3")]<- "03-Food Source"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="4")]<- "04-Food Protection"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="5")]<- "05-Working Environment Safety"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="6")]<- "06-Workers Cleanliness"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="7")]<- "07-Duties of Officer"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="8")]<- "08-Facility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="9")]<- "09-Food Storage"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="10")]<- "10-Utility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="15")]<- "15-Tabacco Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="16")]<- "16-Food Nuitrition/Calories"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="18")]<- "18-Documents Not Present"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="20")]<- "20-Information Not Posted"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="22")]<- "22-Facility Issues 2"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="99")]<- "99-Other General Violation"
install.packages("dygraphs")
View(df1)
dataxts <- NULL
rest <- unique(df1$DBA)
length(rest)
rest[1]
View(df1)
dataxts <- NULL
rest <- unique(df1$DBA)
for(l in 1:length(rest)){
datacounty <- df1[df1$DBA == rest[i],]
dd <- xts(datacounty[, "n"], as.Date(paste0(datacounty$INSPECTION.YEAR, "-01-01")))
dataxts <- cbind(dataxts, dd)
}
for(l in 1:length(rest)){
datacounty <- df1[df1$DBA == rest[l],]
dd <- xts(datacounty[, "n"], as.Date(paste0(datacounty$INSPECTION.YEAR, "-01-01")))
dataxts <- cbind(dataxts, dd)
}
install.packages("xts")
library(dygraphs)
library(xts)
dataxts <- NULL
rest <- unique(df1$DBA)
for(l in 1:length(rest)){
datacounty <- df1[df1$DBA == rest[l],]
dd <- xts(datacounty[, "n"], as.Date(paste0(datacounty$INSPECTION.YEAR, "-01-01")))
dataxts <- cbind(dataxts, dd)
}
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
dataxts <- cbind(dataxts, dd)
dd <- xts(datacounty[, "n"], as.Date(paste0(datacounty$INSPECTION.YEAR, "-01-01")))
colnames(dataxts) <- counties
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
dataxts <- cbind(dataxts, dd)
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
colnames(dataxts) <- counties
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
datacounty <- df1[df1$DBA == rest[1],]
datacounty
View(datacounty)
?`xts-package`
?xts
View(dd)
View(datacounty)
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
rest[1]
?group_by
?unique
View(df1)
library(dygraphs)
library(xts)
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
View(datacounty)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,VIOLATION.CODE, lat,long,INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
View(datacounty)
rest <- unique(df1$n)
rest <- unique(df1$INSPECTION.YEAR)
rest
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
?xts
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
runApp()
runApp()
library(dygraphs)
library(xts)
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)-> d1
d1$x$css = "
.dygraph-legend > span {display:none;}
.dygraph-legend > span.highlight { display: inline; }
"
d1
runApp()
runApp()
runApp()
runApp()
library(dygraphs)
library(xts)
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest[1],]
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
year <- unique(df1$INSPECTION.YEAR)
View(streetview)
?distinct
datacounty <- distinct(datacounty,INSPECTION.YEAR)
View(datacounty)
datacounty <- df1[df1$DBA == rest[1],]
View(datacounty)
datacounty <- distinct(datacounty,INSPECTION.YEAR, .keep_all = T)
View(datacounty)
datacounty <- distinct(datacounty,INSPECTION.YEAR)
View(datacounty)
datacounty <- distinct(datacounty,INSPECTION.YEAR, .keep_all = T)
View(datacounty)
datacounty <- distinct(datacounty,INSPECTION.YEAR, .keep_all = T)
datacounty <- df1[df1$DBA == rest[1],]
datacounty <- distinct(datacounty,INSPECTION.YEAR, .keep_all = T)
source('~/Desktop/functuon.R', echo=TRUE)
dd <- xts(datacounty[, "n"], datacounty$INSPECTION.YEAR)
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
dd <- xts(datacounty[, "n"],as.Date(as.datedatacounty$INSPECTION.YEAR))
dd <- xts(datacounty[, "n"],as.Date(datacounty$INSPECTION.YEAR))
?as.Date
dd <- xts(datacounty[, "n"],as.Date(paste0(datacounty$INSPECTION.YEAR, "-01-01")))
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
runApp()
runApp()
runApp()
?paste0
runApp()
runApp()
runApp()
View(df1)
runApp()
runApp()
## 2. violation category
vio_cat <- df1 %>% group_by(DBA, VIOLATION.CODE,VIOLATION.DESCRIPTION) %>% summarise(n.cat=n())
View(vio_cat)
data_cat <- vio_cat[vio_cat$DBA==rest[1],]
View(data_cat)
View(vio_cat)
## 2. violation category
vio_cat <- df1 %>% group_by(DBA, VIOLATION.CODE,VIOLATION.DESCRIPTION) %>% mutate(n.cat=n())
View(vio_cat)
data_cat <- vio_cat[vio_cat$DBA==rest[1],]
View(data_cat)
## 2. violation category
df2 <- df1 %>% group_by(DBA, VIOLATION.CODE,VIOLATION.DESCRIPTION) %>% mutate(n.cat=n())
View(df2)
data_cat <- df2[df2$DBA==rest[1],]
View(data_cat)
data_cat <- df2[df2$DBA==rest[1],]$VIOLATION.DESCRIPTION
data_cat
data_cat <- df2[df2$DBA==rest[1],]$VIOLATION.DESCRIPTION
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n)) +
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
library(ggplot2)
data_cat <- df2[df2$DBA==rest[1],]$VIOLATION.DESCRIPTION
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n)) +
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
data_cat <- data.frame(data_cat)
View(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n)) +
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
ggplot(data_cat)) +
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
ggplot(data_cat)+
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
data_cat
install.packages('gcookbook')#R数据可视化手册书中的数据集
## 2. violation category
df2 <- df1 %>% group_by(DBA, VIOLATION.CODE,VIOLATION.DESCRIPTION) %>% summarise(n.cat=n())
View(df2)
data_cat <- df2[df2$DBA==rest[1],]$VIOLATION.DESCRIPTION
data_cat <- data.frame(data_cat)
View(data_cat)
data_cat <- df2[df2$DBA==rest[1],]
data_cat <- data.frame(data_cat)
View(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n.cat))+
geom_bar(stat="identity", col="black", fill="light blue") +
labs( title="Adults 20-40") +
coord_flip()
library(ggplot2)
data_cat <- df2[df2$DBA==rest[1],]
data_cat <- data.frame(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n.cat))+
geom_bar(stat="identity", col="light blue", fill="light blue") +
labs( title="Category of Violation") +
coord_flip()
View(data_cat)
library(ggplot2)
data_cat <- df2[df2$DBA==rest[1],]
data_cat <- data.frame(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n.cat))+
geom_bar(stat="identity", col="light blue", fill="light blue") +
labs(x="Number of violation", y="Violation Description",  title="Category of Violation") +
coord_flip()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rest[1]
runApp()
setwd('/Users/apple/Documents/GitHub/Spring2019-Proj2-grp3/app')
load(file = 'finaldata.RData')
smry_trends <-
finaldata %>%
filter(!is.na(GRADE.DATE) & GRADE %in% c('A', 'B', 'C')) %>%
group_by(GRADE.DATE, GRADE) %>%
summarise(CNT = n())
df <- finaldata %>%
filter(!is.na(lat) & !is.na(long)) %>%
filter(as.numeric(lat) > 40.60000 & as.numeric(lat) < 40.80000) %>%
filter(as.numeric(long) > -74.00000 & as.numeric(long) < -73.70000) %>%
group_by(DBA, BORO) %>%
summarize(lat = max(as.numeric(lat)),
long = max(as.numeric(long)))
streetview <- data.frame(lat = -37.817714,
long = 144.967260,
info = "Flinders Street Station")
map_key <- "AIzaSyBfQD4gSCEB6BJEVlC7gS7jpj-BMIZvCYE"
score <-  finaldata %>%
filter(!is.na(SCORE)) %>%
group_by(DBA, INSPECTION.YEAR, INSPECTION.MONTH, lat, long) %>%
summarise(score = mean(SCORE))
## 1. number of violation
#names(finaldata)
df1 <- finaldata %>% group_by(DBA,INSPECTION.YEAR)%>%
mutate(n=n()) %>% subset(select=c(DBA,BORO,CUISINE.DESCRIPTION,VIOLATION.CODE, lat,long,INSPECTION.YEAR,n))
df1 <- df1%>%filter(!is.null(DBA) & !is.na(DBA))
df1$VIOLATION.CODE <- apply(matrix(as.character(df1$VIOLATION.CODE)),1,
function(x) substring(x,1,2))
df1$VIOLATION.CODE <- as.numeric(df1$VIOLATION.CODE)
df1 <- na.omit(df1)
df1$VIOLATION.DESCRIPTION <- NA
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="2")]<- "02-Food Temperature"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="3")]<- "03-Food Source"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="4")]<- "04-Food Protection"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="5")]<- "05-Working Environment Safety"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="6")]<- "06-Workers Cleanliness"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="7")]<- "07-Duties of Officer"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="8")]<- "08-Facility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="9")]<- "09-Food Storage"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="10")]<- "10-Utility Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="15")]<- "15-Tabacco Issues"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="16")]<- "16-Food Nuitrition/Calories"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="18")]<- "18-Documents Not Present"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="20")]<- "20-Information Not Posted"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="22")]<- "22-Facility Issues 2"
df1$VIOLATION.DESCRIPTION[which(df1$VIOLATION.CODE=="99")]<- "99-Other General Violation"
## 2. violation category
df2 <- df1 %>% group_by(DBA, VIOLATION.CODE,VIOLATION.DESCRIPTION) %>% summarise(n.cat=n())
streetview <- data.frame(lat = 40.7128,
long = -74.0060)
map_key <- "AIzaSyBfQD4gSCEB6BJEVlC7gS7jpj-BMIZvCYE"
library(shiny)
library(shinydashboard)
library(googleway)
library(xts)
library(leaflet)
library(dplyr)
library(tidyr)
library(ggplot2)
server <- function(input,output, session){
#CITY SUMMARY#
output$smry_trend <-
renderPlot({city_counts_graph <- (ggplot(smry_trends, aes(x = GRADE.DATE, y = CNT, group = GRADE, color = GRADE)) +
geom_line())
city_counts_graph
})
#SEARCH RESTAURANTS#
#drive the map of restaurants#
data <- reactive({x <- df})
output$map <- renderLeaflet({
df <- data()
m <- leaflet(data = df) %>%
addTiles() %>%
addMarkers(lng = ~as.numeric(long),
lat = ~as.numeric(lat),
popup = paste("DBA", df$DBA,
"BORO", df$BORO,
"lat", df$lat,
"long", df$long))
m
})
#RESTAURANT SUMMARY#
#number of violation plot
output$timetrend <- renderDygraph({
dataxts <- NULL
rest <- unique(df1$DBA)
datacounty <- df1[df1$DBA == rest["MYTHAI CAFE"],]
datacounty <- distinct(datacounty,INSPECTION.YEAR, .keep_all = T)
dd <- xts(datacounty[, "n"],as.Date(paste0(datacounty$INSPECTION.YEAR, "-12-31")))
dataxts <- cbind(dataxts, dd)
dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
})
#drive streetview
output$street <- renderGoogle_map({
google_map(location = c(streetview$lat, streetview$lon), key = map_key, search_box = T)
})
#time series
library(dygraphs)
output$timetrend <- renderDygraph({
scores <- subset(score,select=c(DBA,INSPECTION.YEAR,INSPECTION.MONTH,score))
data <- scores[scores$DBA=="ROMA PIZZA",]
dataxts <- xts(data$score, as.Date(paste0(data$INSPECTION.YEAR,"-",data$INSPECTION.MONTH,"-01")))
# d1 <- dygraph(dataxts) %>% dyHighlight(highlightSeriesBackgroundAlpha = 0.2)
d1<-dygraph(dataxts, main = "SCORES") %>%
dySeries("V1", label = "scores") %>%
dyLegend(show = "follow")
d1
})
#category of violation
output$cat <- renderPlot({
data_cat <- df2[df2$DBA==rest[1],] #?change
data_cat <- data.frame(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n.cat))+
geom_bar(stat="identity", col="light green", fill="light green") +
labs(x="Number of violation", y="Violation Description",  title="Category of Violation") +
coord_flip()
})
}
runApp()
runApp()
runApp()
runApp()
data_cat <- df2[df2$DBA==rest["MYTHAI CAFE"],] #?change
data_cat <- data.frame(data_cat)
ggplot(data_cat, aes(x=VIOLATION.DESCRIPTION, y=n.cat))+
geom_bar(stat="identity", col="light green", fill="light green") +
labs(x="Number of violation", y="Violation Description",  title="Category of Violation") +
coord_flip()
runApp()
runApp()
rest
rest[1]
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?renderUI
runApp()
runApp()
runApp()
